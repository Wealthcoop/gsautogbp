(()=>{var e={};e.id=136,e.ids=[136],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},86624:e=>{"use strict";e.exports=require("querystring")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},2397:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>o,routeModule:()=>h,tree:()=>c}),t(82566),t(27612),t(35866);var a=t(23191),r=t(88716),l=t(37922),i=t.n(l),n=t(95231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(s,d);let c=["",{children:["posts",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,82566)),"/home/ubuntu/gsautogbp/app/posts/[id]/edit/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,27612)),"/home/ubuntu/gsautogbp/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}],o=["/home/ubuntu/gsautogbp/app/posts/[id]/edit/page.tsx"],u="/posts/[id]/edit/page",m={require:t,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/posts/[id]/edit/page",pathname:"/posts/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},59832:(e,s,t)=>{Promise.resolve().then(t.bind(t,90085)),Promise.resolve().then(t.bind(t,88037))},88037:(e,s,t)=>{"use strict";t.d(s,{default:()=>S});var a=t(10326),r=t(17577),l=t(4891),i=t(35047),n=t(86333),d=t(40765),c=t(37358),o=t(71709),u=t(63685),m=t(77506),h=t(24527),x=t(12714),p=t(31215),j=t(90772),g=t(54432),v=t(45842),f=t(87673),N=t(33071),y=t(34474),b=t(73427),w=t(567),P=t(94215),E=t(90434);function S({postId:e}){let[s,t]=(0,r.useState)(null),[S,F]=(0,r.useState)(""),[_,C]=(0,r.useState)(""),[D,Z]=(0,r.useState)("UPDATE"),[T,q]=(0,r.useState)(""),[O,U]=(0,r.useState)(""),[k,I]=(0,r.useState)(""),[A,V]=(0,r.useState)(""),[G,Y]=(0,r.useState)(""),[R,L]=(0,r.useState)(""),[z,M]=(0,r.useState)(""),[B,Q]=(0,r.useState)(""),[J,$]=(0,r.useState)(!1),[W,X]=(0,r.useState)(!1),[H,K]=(0,r.useState)(!0),ee=(0,i.useRouter)(),{toast:es}=(0,P.pm)(),et=async()=>{if(!B.trim()){es({title:"Error",description:"Please enter a description for the image",variant:"destructive"});return}$(!0);try{let e=await fetch("/api/generate-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:B})});if(e.ok){let s=await e.json();q(s.imageUrl),es({title:"Success",description:"Image generated successfully"})}else throw Error("Failed to generate image")}catch(e){console.error("Error generating image:",e),es({title:"Error",description:"Failed to generate image",variant:"destructive"})}finally{$(!1)}},ea=async()=>{if(!S.trim()||!_.trim()){es({title:"Error",description:"Please fill in title and content",variant:"destructive"});return}X(!0);try{let s=await fetch(`/api/posts/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:S,content:_,type:D,imageUrl:T||null,scheduledAt:O||null,eventStartDate:"EVENT"===D?k:null,eventEndDate:"EVENT"===D?A:null,eventLocation:"EVENT"===D?G:null,offerValidUntil:"OFFER"===D?R:null,offerTerms:"OFFER"===D?z:null})});if(s.ok)es({title:"Success",description:"Post updated successfully"}),ee.push("/posts");else{let e=await s.json();throw Error(e.error||"Failed to update post")}}catch(e){console.error("Error updating post:",e),es({title:"Error",description:e.message||"Failed to update post",variant:"destructive"})}finally{X(!1)}};return H?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s?(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx(j.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)(E.default,{href:"/posts",children:[a.jsx(n.Z,{className:"h-4 w-4 mr-2"}),"Back to Posts"]})}),(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Edit Post"}),a.jsx("p",{className:"text-muted-foreground",children:"Update your Google Business Profile post"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"lg:col-span-2 space-y-6",children:[(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[a.jsx(N.Ol,{children:(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[a.jsx(d.Z,{className:"h-5 w-5"}),"Post Details"]})}),(0,a.jsxs)(N.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx(v._,{htmlFor:"title",children:"Title"}),a.jsx(g.I,{id:"title",placeholder:"Enter post title...",value:S,onChange:e=>F(e.target.value),className:"mt-1"})]}),(0,a.jsxs)("div",{children:[a.jsx(v._,{htmlFor:"type",children:"Post Type"}),(0,a.jsxs)(y.Ph,{value:D,onValueChange:Z,children:[a.jsx(y.i4,{className:"mt-1",children:a.jsx(y.ki,{})}),(0,a.jsxs)(y.Bw,{children:[a.jsx(y.Ql,{value:"UPDATE",children:"General Update"}),a.jsx(y.Ql,{value:"EVENT",children:"Event"}),a.jsx(y.Ql,{value:"OFFER",children:"Offer/Promotion"})]})]})]}),(0,a.jsxs)("div",{children:[a.jsx(v._,{htmlFor:"content",children:"Content"}),a.jsx(f.g,{id:"content",placeholder:"Write your post content here...",value:_,onChange:e=>C(e.target.value),className:"mt-1 min-h-32"})]})]})]}),"EVENT"===D&&(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[a.jsx(N.Ol,{children:(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[a.jsx(c.Z,{className:"h-5 w-5"}),"Event Details"]})}),(0,a.jsxs)(N.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx(v._,{htmlFor:"eventStartDate",children:"Start Date"}),a.jsx(g.I,{id:"eventStartDate",type:"datetime-local",value:k,onChange:e=>I(e.target.value),className:"mt-1"})]}),(0,a.jsxs)("div",{children:[a.jsx(v._,{htmlFor:"eventEndDate",children:"End Date"}),a.jsx(g.I,{id:"eventEndDate",type:"datetime-local",value:A,onChange:e=>V(e.target.value),className:"mt-1"})]})]}),(0,a.jsxs)("div",{children:[a.jsx(v._,{htmlFor:"eventLocation",children:"Location"}),a.jsx(g.I,{id:"eventLocation",placeholder:"Event location...",value:G,onChange:e=>Y(e.target.value),className:"mt-1"})]})]})]}),"OFFER"===D&&(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[a.jsx(N.Ol,{children:(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[a.jsx(d.Z,{className:"h-5 w-5"}),"Offer Details"]})}),(0,a.jsxs)(N.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx(v._,{htmlFor:"offerValidUntil",children:"Valid Until"}),a.jsx(g.I,{id:"offerValidUntil",type:"datetime-local",value:R,onChange:e=>L(e.target.value),className:"mt-1"})]}),(0,a.jsxs)("div",{children:[a.jsx(v._,{htmlFor:"offerTerms",children:"Terms & Conditions"}),a.jsx(f.g,{id:"offerTerms",placeholder:"Terms and conditions...",value:z,onChange:e=>M(e.target.value),className:"mt-1"})]})]})]})]}),(0,a.jsxs)(l.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},className:"space-y-6",children:[(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[a.jsx(N.Ol,{children:(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[a.jsx(o.Z,{className:"h-5 w-5"}),"Post Image"]})}),(0,a.jsxs)(N.aY,{children:[(0,a.jsxs)(b.mQ,{defaultValue:"upload",className:"w-full",children:[(0,a.jsxs)(b.dr,{className:"grid w-full grid-cols-2",children:[a.jsx(b.SP,{value:"upload",children:"Upload"}),a.jsx(b.SP,{value:"generate",children:"AI Generate"})]}),a.jsx(b.nU,{value:"upload",className:"space-y-4",children:a.jsx("div",{className:"flex items-center justify-center w-full",children:(0,a.jsxs)("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer bg-muted hover:bg-muted/80 transition-colors",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[a.jsx(u.Z,{className:"w-8 h-8 mb-2 text-muted-foreground"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload image"})]}),a.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:e=>{let s=e.target.files?.[0];if(s){let e=new FileReader;e.onload=e=>{q(e.target?.result)},e.readAsDataURL(s)}}})]})})}),(0,a.jsxs)(b.nU,{value:"generate",className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx(v._,{htmlFor:"imagePrompt",children:"Describe the image"}),a.jsx(f.g,{id:"imagePrompt",placeholder:"A professional business photo showing...",value:B,onChange:e=>Q(e.target.value),className:"mt-1"})]}),a.jsx(j.z,{onClick:et,disabled:J||!B.trim(),className:"w-full",children:J?(0,a.jsxs)(a.Fragment,{children:[a.jsx(m.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(h.Z,{className:"mr-2 h-4 w-4"}),"Generate Image"]})})]})]}),T&&a.jsx("div",{className:"mt-4",children:a.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-muted",children:a.jsx("img",{src:T,alt:"Post preview",className:"w-full h-full object-cover"})})})]})]}),(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[(0,a.jsxs)(N.Ol,{children:[(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[a.jsx(c.Z,{className:"h-5 w-5"}),"Schedule Post"]}),a.jsx(N.SZ,{children:"Update the publication schedule"})]}),a.jsx(N.aY,{children:(0,a.jsxs)("div",{children:[a.jsx(v._,{htmlFor:"scheduledAt",children:"Publish Date & Time"}),a.jsx(g.I,{id:"scheduledAt",type:"datetime-local",value:O,onChange:e=>U(e.target.value),min:(()=>{let e=new Date;return e.setMinutes(e.getMinutes()+30),e.toISOString().slice(0,16)})(),max:(()=>{let e=new Date;return e.setFullYear(e.getFullYear()+1),e.toISOString().slice(0,16)})(),className:"mt-1"}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Leave empty to save as draft"})]})})]}),(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[a.jsx(N.Ol,{children:(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[a.jsx(x.Z,{className:"h-5 w-5"}),"Preview"]})}),a.jsx(N.aY,{children:a.jsx("div",{className:"border rounded-lg p-4 bg-background",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx(w.C,{variant:"outline",children:D}),a.jsx("p",{className:"text-xs text-muted-foreground",children:O?`Scheduled: ${new Date(O).toLocaleDateString()}`:"Draft"})]}),S&&a.jsx("h3",{className:"font-medium text-sm",children:S}),_&&a.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:_}),T&&a.jsx("div",{className:"relative aspect-video rounded overflow-hidden bg-muted",children:a.jsx("img",{src:T,alt:"Preview",className:"w-full h-full object-cover"})})]})})})]}),a.jsx(N.Zb,{className:"card-shadow",children:a.jsx(N.aY,{className:"pt-6",children:a.jsx(j.z,{onClick:ea,disabled:W||!S.trim()||!_.trim(),className:"w-full",children:W?(0,a.jsxs)(a.Fragment,{children:[a.jsx(m.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(p.Z,{className:"mr-2 h-4 w-4"}),"Update Post"]})})})})]})]})]}):(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("p",{children:"Post not found"}),a.jsx(j.z,{asChild:!0,className:"mt-4",children:a.jsx(E.default,{href:"/posts",children:"Back to Posts"})})]})}},82566:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var a=t(19510),r=t(58585),l=t(75571),i=t(90455),n=t(40732);let d=(0,t(68570).createProxy)(String.raw`/home/ubuntu/gsautogbp/components/posts/post-edit-form.tsx#default`);async function c({params:e}){return await (0,l.getServerSession)((0,i.b)())||(0,r.redirect)("/login"),a.jsx(n.Z,{children:a.jsx(d,{postId:e.id})})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[276,776,83,283,404,129,964,970,847,583,12],()=>t(2397));module.exports=a})();