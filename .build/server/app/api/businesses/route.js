"use strict";(()=>{var e={};e.id=201,e.ids=[201],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},34274:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>T,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>h,dynamic:()=>d});var o=r(49303),a=r(88716),n=r(60670),i=r(87070),c=r(75571),l=r(90455),u=r(62435),p=r(9487);let d="force-dynamic";async function h(e){try{let e=await (0,c.getServerSession)((0,l.b)());if(!e?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let t=await (0,u.qb)(e.user.id);if(!t)return i.NextResponse.json({error:"Google access token not found"},{status:401});let r=new u.$w(t),s=(await r.getBusinessAccounts()).accounts||[],o=[];for(let t of s)try{for(let s of(await r.getBusinessLocations(t.name)).locations||[]){let t={googleId:s.name,name:s.title||s.name,address:s.storefrontAddress?`${s.storefrontAddress.addressLines?.join(", ")}, ${s.storefrontAddress.locality}, ${s.storefrontAddress.administrativeArea} ${s.storefrontAddress.postalCode}`:"",phoneNumber:s.primaryPhone||null,websiteUrl:s.websiteUrl||null,category:s.primaryCategory?.displayName||null,isVerified:!!s.metadata?.mapsUrl},r=await (0,p.a)().business.upsert({where:{googleId:t.googleId},update:t,create:{...t,userId:e.user.id}});o.push(r)}}catch(e){console.error(`Error fetching locations for account ${t.name}:`,e)}return i.NextResponse.json({businesses:o})}catch(e){return console.error("Error fetching businesses:",e),i.NextResponse.json({error:"Failed to fetch businesses"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/businesses/route",pathname:"/api/businesses",filename:"route",bundlePath:"app/api/businesses/route"},resolvedPagePath:"/home/ubuntu/gsautogbp/app/api/businesses/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:w}=m,y="/api/businesses/route";function T(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:g})}},90455:(e,t,r)=>{r.d(t,{b:()=>l});var s=r(77234),o=r(53797),a=r(13539),n=r(9487),i=r(42023),c=r.n(i);function l(){let e;try{e=(0,a.N)((0,n.a)())}catch(t){console.warn("Prisma adapter not available during build:",t),e=void 0}return{adapter:e,providers:[(0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,authorization:{params:{scope:"openid email profile https://www.googleapis.com/auth/business.manage"}}}),(0,o.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let t=(0,n.a)(),r=await t.user.findUnique({where:{email:e.email}});if(!r||!r.password||!await c().compare(e.password,r.password))return null;return{id:r.id,email:r.email,name:r.name,plan:r.plan}}catch(e){return console.error("Error during authentication:",e),null}}})],session:{strategy:"jwt"},pages:{signIn:"/login"},callbacks:{jwt:async({token:e,user:t,account:r})=>(t&&(e.id=t.id,e.plan=t.plan),r&&(e.accessToken=r.access_token,e.refreshToken=r.refresh_token),e),session:async({session:e,token:t})=>(t&&e.user&&(e.user.id=t.id,e.user.plan=t.plan),e),async signIn({user:e,account:t}){if(t?.provider==="google")try{let t=(0,n.a)();await t.user.upsert({where:{email:e.email},update:{},create:{email:e.email,name:e.name,image:e.image,plan:"FREE"}})}catch(e){console.error("Error creating/updating user:",e)}else t?.provider;return!0}}}}},9487:(e,t,r)=>{r.d(t,{a:()=>a});var s=r(53524);let o=globalThis;function a(){return function(){if(!o.prisma){if(!process.env.DATABASE_URL)throw Error("DATABASE_URL is required in production");o.prisma=new s.PrismaClient}return o.prisma}()}new Proxy({},{get(e,t){let r=a(),s=r[t];return"function"==typeof s?s.bind(r):s}})},62435:(e,t,r)=>{r.d(t,{$w:()=>o,qb:()=>a,u3:()=>i});var s=r(9487);class o{constructor(e){this.accessToken=e,this.baseUrl="https://mybusinessbusinessinformation.googleapis.com/v1",this.postsBaseUrl="https://mybusiness.googleapis.com/v4"}async getBusinessAccounts(){let e=await fetch(`${this.baseUrl}/accounts`,{headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!e.ok)throw Error(`Failed to fetch accounts: ${e.statusText}`);return e.json()}async getBusinessLocations(e){let t=await fetch(`${this.baseUrl}/accounts/${e}/locations`,{headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!t.ok)throw Error(`Failed to fetch locations: ${t.statusText}`);return t.json()}async createPost(e,t){let r=await fetch(`${this.postsBaseUrl}/${e}/localPosts`,{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){let e=await r.text();throw Error(`Failed to create post: ${r.statusText} - ${e}`)}return r.json()}async getPosts(e){let t=await fetch(`${this.postsBaseUrl}/${e}/localPosts`,{headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!t.ok)throw Error(`Failed to fetch posts: ${t.statusText}`);return t.json()}async deletePost(e){let t=await fetch(`${this.postsBaseUrl}/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!t.ok)throw Error(`Failed to delete post: ${t.statusText}`)}}async function a(e){try{let t=await (0,s.a)().account.findFirst({where:{userId:e,provider:"google"}});if(!t?.access_token)return null;if(t.expires_at&&1e3*t.expires_at<Date.now()){let e=await n(t.refresh_token);if(e)return await (0,s.a)().account.update({where:{id:t.id},data:{access_token:e.access_token,expires_at:e.expires_at}}),e.access_token;return null}return t.access_token}catch(e){return console.error("Error getting Google access token:",e),null}}async function n(e){try{let t=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:process.env.GOOGLE_CLIENT_ID,client_secret:process.env.GOOGLE_CLIENT_SECRET,refresh_token:e,grant_type:"refresh_token"})});if(!t.ok)throw Error("Failed to refresh token");let r=await t.json();return{access_token:r.access_token,expires_at:Math.floor(Date.now()/1e3)+r.expires_in}}catch(e){return console.error("Error refreshing Google token:",e),null}}function i(e){let t={name:"",languageCode:"en",summary:e.content,topicType:"STANDARD"};switch(e.imageUrl&&(t.media=[{mediaFormat:"PHOTO",sourceUrl:e.imageUrl}]),e.type){case"EVENT":t.topicType="EVENT",e.eventStartDate&&e.eventEndDate&&(t.event={title:e.title,schedule:{startDate:e.eventStartDate.toISOString().split("T")[0],startTime:e.eventStartDate.toISOString().split("T")[1].split(".")[0],endDate:e.eventEndDate.toISOString().split("T")[0],endTime:e.eventEndDate.toISOString().split("T")[1].split(".")[0]}});break;case"OFFER":t.topicType="OFFER",e.offerTerms&&(t.offer={termsConditions:e.offerTerms})}return t}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,776,83,972],()=>r(34274));module.exports=s})();