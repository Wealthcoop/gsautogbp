(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[136],{4888:function(e,s,t){Promise.resolve().then(t.bind(t,9726)),Promise.resolve().then(t.bind(t,2425))},2425:function(e,s,t){"use strict";t.d(s,{default:function(){return F}});var a=t(5444),l=t(9300),i=t(3135),r=t(9047),n=t(8155),c=t(7665),d=t(5012),o=t(572),h=t(4805),m=t(1946),u=t(4226),x=t(8082),j=t(8382),p=t(2422),g=t(4678),f=t(3508),v=t(7012),N=t(9827),w=t(489),y=t(3302),E=t(1335),S=t(5854),b=t(1084);function F({postId:e}){let[s,t]=(0,l.useState)(null),[F,D]=(0,l.useState)(""),[P,C]=(0,l.useState)(""),[O,U]=(0,l.useState)("UPDATE"),[T,Z]=(0,l.useState)(""),[I,_]=(0,l.useState)(""),[k,V]=(0,l.useState)(""),[A,Y]=(0,l.useState)(""),[L,R]=(0,l.useState)(""),[z,G]=(0,l.useState)(""),[B,Q]=(0,l.useState)(""),[$,J]=(0,l.useState)(""),[M,W]=(0,l.useState)(!1),[q,H]=(0,l.useState)(!1),[K,X]=(0,l.useState)(!0),ee=(0,r.useRouter)(),{toast:es}=(0,S.pm)();(0,l.useEffect)(()=>{et()},[e]);let et=async()=>{try{let s=await fetch(`/api/posts/${e}`);if(s.ok){let e=(await s.json()).post;t(e),D(e.title),C(e.content),U(e.type),Z(e.imageUrl||""),_(e.scheduledAt?new Date(e.scheduledAt).toISOString().slice(0,16):""),V(e.eventStartDate?new Date(e.eventStartDate).toISOString().slice(0,16):""),Y(e.eventEndDate?new Date(e.eventEndDate).toISOString().slice(0,16):""),R(e.eventLocation||""),G(e.offerValidUntil?new Date(e.offerValidUntil).toISOString().slice(0,16):""),Q(e.offerTerms||"")}else throw Error("Failed to fetch post")}catch(e){console.error("Error fetching post:",e),es({title:"Error",description:"Failed to load post",variant:"destructive"}),ee.push("/posts")}finally{X(!1)}},ea=async()=>{if(!$.trim()){es({title:"Error",description:"Please enter a description for the image",variant:"destructive"});return}W(!0);try{let e=await fetch("/api/generate-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:$})});if(e.ok){let s=await e.json();Z(s.imageUrl),es({title:"Success",description:"Image generated successfully"})}else throw Error("Failed to generate image")}catch(e){console.error("Error generating image:",e),es({title:"Error",description:"Failed to generate image",variant:"destructive"})}finally{W(!1)}},el=async()=>{if(!F.trim()||!P.trim()){es({title:"Error",description:"Please fill in title and content",variant:"destructive"});return}H(!0);try{let s=await fetch(`/api/posts/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:F,content:P,type:O,imageUrl:T||null,scheduledAt:I||null,eventStartDate:"EVENT"===O?k:null,eventEndDate:"EVENT"===O?A:null,eventLocation:"EVENT"===O?L:null,offerValidUntil:"OFFER"===O?z:null,offerTerms:"OFFER"===O?B:null})});if(s.ok)es({title:"Success",description:"Post updated successfully"}),ee.push("/posts");else{let e=await s.json();throw Error(e.error||"Failed to update post")}}catch(e){console.error("Error updating post:",e),es({title:"Error",description:e.message||"Failed to update post",variant:"destructive"})}finally{H(!1)}};return K?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s?(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,a.jsx)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(p.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)(b.default,{href:"/posts",children:[(0,a.jsx)(n.Z,{className:"h-4 w-4 mr-2"}),"Back to Posts"]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Edit Post"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Update your Google Business Profile post"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)(i.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"lg:col-span-2 space-y-6",children:[(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[(0,a.jsx)(N.Ol,{children:(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"h-5 w-5"}),"Post Details"]})}),(0,a.jsxs)(N.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(f._,{htmlFor:"title",children:"Title"}),(0,a.jsx)(g.I,{id:"title",placeholder:"Enter post title...",value:F,onChange:e=>D(e.target.value),className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(f._,{htmlFor:"type",children:"Post Type"}),(0,a.jsxs)(w.Ph,{value:O,onValueChange:U,children:[(0,a.jsx)(w.i4,{className:"mt-1",children:(0,a.jsx)(w.ki,{})}),(0,a.jsxs)(w.Bw,{children:[(0,a.jsx)(w.Ql,{value:"UPDATE",children:"General Update"}),(0,a.jsx)(w.Ql,{value:"EVENT",children:"Event"}),(0,a.jsx)(w.Ql,{value:"OFFER",children:"Offer/Promotion"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(f._,{htmlFor:"content",children:"Content"}),(0,a.jsx)(v.g,{id:"content",placeholder:"Write your post content here...",value:P,onChange:e=>C(e.target.value),className:"mt-1 min-h-32"})]})]})]}),"EVENT"===O&&(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[(0,a.jsx)(N.Ol,{children:(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"h-5 w-5"}),"Event Details"]})}),(0,a.jsxs)(N.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(f._,{htmlFor:"eventStartDate",children:"Start Date"}),(0,a.jsx)(g.I,{id:"eventStartDate",type:"datetime-local",value:k,onChange:e=>V(e.target.value),className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(f._,{htmlFor:"eventEndDate",children:"End Date"}),(0,a.jsx)(g.I,{id:"eventEndDate",type:"datetime-local",value:A,onChange:e=>Y(e.target.value),className:"mt-1"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(f._,{htmlFor:"eventLocation",children:"Location"}),(0,a.jsx)(g.I,{id:"eventLocation",placeholder:"Event location...",value:L,onChange:e=>R(e.target.value),className:"mt-1"})]})]})]}),"OFFER"===O&&(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[(0,a.jsx)(N.Ol,{children:(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"h-5 w-5"}),"Offer Details"]})}),(0,a.jsxs)(N.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(f._,{htmlFor:"offerValidUntil",children:"Valid Until"}),(0,a.jsx)(g.I,{id:"offerValidUntil",type:"datetime-local",value:z,onChange:e=>G(e.target.value),className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(f._,{htmlFor:"offerTerms",children:"Terms & Conditions"}),(0,a.jsx)(v.g,{id:"offerTerms",placeholder:"Terms and conditions...",value:B,onChange:e=>Q(e.target.value),className:"mt-1"})]})]})]})]}),(0,a.jsxs)(i.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},className:"space-y-6",children:[(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[(0,a.jsx)(N.Ol,{children:(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5"}),"Post Image"]})}),(0,a.jsxs)(N.aY,{children:[(0,a.jsxs)(y.mQ,{defaultValue:"upload",className:"w-full",children:[(0,a.jsxs)(y.dr,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(y.SP,{value:"upload",children:"Upload"}),(0,a.jsx)(y.SP,{value:"generate",children:"AI Generate"})]}),(0,a.jsx)(y.nU,{value:"upload",className:"space-y-4",children:(0,a.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,a.jsxs)("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer bg-muted hover:bg-muted/80 transition-colors",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,a.jsx)(h.Z,{className:"w-8 h-8 mb-2 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Click to upload image"})]}),(0,a.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:e=>{let s=e.target.files?.[0];if(s){let e=new FileReader;e.onload=e=>{Z(e.target?.result)},e.readAsDataURL(s)}}})]})})}),(0,a.jsxs)(y.nU,{value:"generate",className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(f._,{htmlFor:"imagePrompt",children:"Describe the image"}),(0,a.jsx)(v.g,{id:"imagePrompt",placeholder:"A professional business photo showing...",value:$,onChange:e=>J(e.target.value),className:"mt-1"})]}),(0,a.jsx)(p.z,{onClick:ea,disabled:M||!$.trim(),className:"w-full",children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Generate Image"]})})]})]}),T&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-muted",children:(0,a.jsx)("img",{src:T,alt:"Post preview",className:"w-full h-full object-cover"})})})]})]}),(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[(0,a.jsxs)(N.Ol,{children:[(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"h-5 w-5"}),"Schedule Post"]}),(0,a.jsx)(N.SZ,{children:"Update the publication schedule"})]}),(0,a.jsx)(N.aY,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)(f._,{htmlFor:"scheduledAt",children:"Publish Date & Time"}),(0,a.jsx)(g.I,{id:"scheduledAt",type:"datetime-local",value:I,onChange:e=>_(e.target.value),min:(()=>{let e=new Date;return e.setMinutes(e.getMinutes()+30),e.toISOString().slice(0,16)})(),max:(()=>{let e=new Date;return e.setFullYear(e.getFullYear()+1),e.toISOString().slice(0,16)})(),className:"mt-1"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Leave empty to save as draft"})]})})]}),(0,a.jsxs)(N.Zb,{className:"card-shadow",children:[(0,a.jsx)(N.Ol,{children:(0,a.jsxs)(N.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"h-5 w-5"}),"Preview"]})}),(0,a.jsx)(N.aY,{children:(0,a.jsx)("div",{className:"border rounded-lg p-4 bg-background",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(E.C,{variant:"outline",children:O}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:I?`Scheduled: ${new Date(I).toLocaleDateString()}`:"Draft"})]}),F&&(0,a.jsx)("h3",{className:"font-medium text-sm",children:F}),P&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-3",children:P}),T&&(0,a.jsx)("div",{className:"relative aspect-video rounded overflow-hidden bg-muted",children:(0,a.jsx)("img",{src:T,alt:"Preview",className:"w-full h-full object-cover"})})]})})})]}),(0,a.jsx)(N.Zb,{className:"card-shadow",children:(0,a.jsx)(N.aY,{className:"pt-6",children:(0,a.jsx)(p.z,{onClick:el,disabled:q||!F.trim()||!P.trim(),className:"w-full",children:q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{className:"mr-2 h-4 w-4"}),"Update Post"]})})})})]})]})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{children:"Post not found"}),(0,a.jsx)(p.z,{asChild:!0,className:"mt-4",children:(0,a.jsx)(b.default,{href:"/posts",children:"Back to Posts"})})]})}}},function(e){e.O(0,[558,162,99,762,569,357,761,396,209,386,156,744],function(){return e(e.s=4888)}),_N_E=e.O()}]);